# 玩家查找基本原理及历史
&emsp;&emsp;本文将介绍在MCNE租赁服中笔者开发并使用的玩家查找方法及历史。

## 0 基本原理
&emsp;&emsp;玩家查找是利用/w指令在开启允许作弊后可以回传选择器选择结果的特性，利用集合的性质，缩小目标所在大致范围的过程。

&emsp;&emsp;在一般的玩家查找中，仅使用dxyz参数（AABB包围盒）与xyzr参数（球形）。选择器参数相关见[MC维基百科](https://zh.minecraft.wiki/w/%E7%9B%AE%E6%A0%87%E9%80%89%E6%8B%A9%E5%99%A8)，本文不予赘述。

&emsp;&emsp;本文中部分用词释义如下：
+ “试探”表示使用指令回传某一区域内玩家的过程；
+ “试探成功”指目标玩家所在坐标点属于试探集合；
+ “试探失败”与试探成功相反；
+ “初始集”指一系列操作开始前便可确定目标玩家所在的集合，常用符号为$S_i$，表示第i次迭代的初始集合。
+ “逃逸”指因为玩家的移动而离开了本应该在的范围导致的查找失败。

### 0.1 半方数与比半方数
&emsp;&emsp;半方数（符号为$N_{\frac{1}{2}}$）表示将目标玩家所处集合“大小”（使用“面积”或“长度“表示）缩小为原来的二分之一所需的试探次数。其计算公式为
$$
N_{\frac{1}{2}}=\frac{n}{log_{\frac{1}{2}}(\frac{A}{A_0})}，
$$
式中$n$为总操作数（期望），$A_0$为初始集合“大小”，$A$为经过$n$次试探后的集合“大小”。

&emsp;&emsp;比半方数（符号为$\eta_{\frac{1}{2}}$，又名相对二分效率）为$N_{\frac{1}{2}}$的倒数，常用百分比表示。其计算公式为
$$
\eta_{\frac{1}{2}}=\frac{1}{N_{\frac{1}{2}}}=\frac{log_{\frac{1}{2}}(\frac{A}{A_0})}{n}，
$$

## 1 初见端倪：跟随法
&emsp;&emsp;跟随法是笔者第一个关于玩家查找的灵感。其本质为沿坐标轴移动一个长方体包围盒或球体的试探集合，若移动后的试探未回传目标玩家，则少量回退移动并再次进行试探，借此逼近坐标范围。交替对xz坐标轴进行操作获取较为精确的二维坐标。

&emsp;&emsp;该方法实际操作十分低效，实际比半方数约为15%上下，且其无法精确定量表示，故非本文叙述重点。

## 2 步上正轨：标准二分及三次四分
&emsp;&emsp;在跟随法出现后不久，经由笔者翻阅资料，更为精确的标准二分法（SD2）被创建。该方法随即被写成自动机及前端程序发布。

&emsp;&emsp;SD2的逻辑较为简单。令$S$为xOz面上的正方形（忽略y值影响），单次迭代过程如下：

1. 记第一次试探为$A_1$，其为$S_i$沿垂直于z轴的平分线一分为二后，对x值整体偏小的长方形进行的试探。
2. 若第一次试探成功，则令玩家所在集$A_m$等于$A_1$，并进入第4步。
3. 则令玩家所在集$A_m$等于$\complement_SA_1$。
4. 记第二次试探为$A_2$，为$A_m$沿垂直于x轴的平分线一分为二后z值偏小的集合。
5. 若第二次试探成功，则令$S_{i+1}$为$A_2$，并进入下一次迭代。
6. 否则令$S_{i+1}$为$\complement_{A_m}A_2$，并进入下一次迭代。
```
 a|       b       c
--+-------+-------+--->
  | Trial | Trial |   x+
  |  #1   |  #2   |
  |       +-------+ d
  |       |       |
  |       |       |
  +-------+-------+ e
  |
 \| z+
```
&emsp;&emsp;例：第一次试探失败且第二次试探成功。

&emsp;&emsp;SD2是除单指令多选择器（见第5.1节分划理论）外理论上最快的方法。但由于其特性，常常存在连续多次试探失败的情况，而不知道玩家是否逃逸。因此在其基础上演变出三次四分（3D4）法。其单次迭代过程如下：

1. 第一次的试探为直接对$S_i$进行的试探。
2. 记第二次试探为$A_1$，为$S_i$沿垂直于z轴的平分线一分为二后，对x值偏小的长方形进行的试探。
3. 记第三次试探为$A_2$，为$S_i$沿垂直于x轴平分线一分为二后，对z值偏小的长方形进行的试探。
4. 对后两次试探的结果分别进行两次如下处理：
    - 若成功，则取$S_i$与当前试探集的交集；
    - 若成功，则取$S_i$与当前试探集的相对差集，即$S_i-A_k$。
5. 取上述两次处理结果的交集为$S_{i+1}$。
```
 a|       b       c
--+-------+-------+--->
  | XXXXX | ///// |   x+
  | XXXXX | ///// |
  |-------+-------+ d
  | \\\\\ |       |
  | \\\\\ |       |
  +-------+-------+ e
  |
 \| z+
```
&emsp;&emsp;两次试探与SD2一样将$S$分为了4块，而第1步的确认消除了连续两次失败带来的不确定。虽然其比半方数高达66.7%，但是其仍未解决二分法本质上的缺点。

## 3 渐入佳境：缩盒法
&emsp;&emsp;二分系方法虽然理论上快，但是若实际上手打，操作仍然过于繁琐：二分无法对齐十进制的数位，每次需要修改的数字过多，且计算繁杂，仍然拖慢了速度。因此，缩盒系列方法应运而生。

&emsp;&emsp;标准k次缩盒（或k分缩盒）法的单次迭代分别将$S$在x轴和z轴上等分为k份，然后分别对两个坐标轴进行逐块试探。令$S$为边长为$k$的正整数次方的正方形，其迭代过程如下（以x轴为例）：

1. 将$S_i$在x轴上均分为$A_1,A_2,...,A_k$这k个区间。
2. 令一临时变量$j=k$。
3. 对$\bigcup_{m=1}^{j}A_m$进行一次试探。
4. 将$j$减去1。
5. 若试探成功且$j>1$则反复执行第2~4步。
6. 若$j\leq1$且试探成功则将目标所在集合$B$设定为$A_1$，并跳转至第9步。
7. 若$j\gt1$且试探失败则将目标所在集合$B$设定为$A_{j+1}$，并跳转至第9步。
8. 记为玩家逃逸。
9. 对$B$在z轴执行上述均分、递减等操作，并将$S_{i+1}$设定为玩家所在集。

&emsp;&emsp;上面的步骤看上去非常复杂，但倘若是标准10分缩盒，实操会变得及其简单。假设目标在$[x=114000,dx=1000]$，即$[114000,115000)$这个区间内，那么我们只需要对$dx$减100，然后进行一次试探。若试探失败则将x加上失败的试探的那次dx，然后将dx设定为100。对于不同的dx，

## 4 大彻大悟：缩盒变种

## 5 进阶：球标及分划法