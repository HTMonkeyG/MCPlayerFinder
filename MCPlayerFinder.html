<!DOCTYPE html>
<html>
 <head>
  <meta name="viewport" 
   content="width=device-width, 
   initial-scale=1.0, 
   maximum-scale=1.0,
   minimum-scale=1.0, 
   user-scalable=no">
  <title>MCPF v1.0</title>
  <meta charset="utf-8">
  <style>
  input{
    outline: none;
  }
  
  body {
    text-align: center;
    background-color: rgb(51,43,40);
    background-image: url('./MCPF_bg.png');
    background-size: 128px;
    background-repeat: repeat;
    display: block;
    height: 100%;
    margin: 0;
    padding: 0;
  }

  .canvas1 {
    width: 65%;
    margin: 10px;
    border-style: solid;
    border-width: 1px;
    border-color: rgba(193,136,94,0.85);
    box-shadow:0 0 8px rgba(193,136,94,.5);
    -moz-box-shadow:0 0 8px rgba(193,136,94,.5);
    -webkit-box-shadow:0 0 8px rgba(193,136,94,.5);
  }
  
  .main {
    display: block;
    width: 100%;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
    background-color: rgba(152,75,67,0.02);
    border-style: solid;
    border-width: 1;
    border-color: rgba(152,75,67,0.7);
    font-size: 90%;
    color: white;
    box-shadow:0 0 8px rgba(152,75,67,.5);
    -moz-box-shadow:0 0 8px rgba(152,75,67,.5);
    -webkit-box-shadow:0 0 8px rgba(152,75,67,3);
  }
  
  .main-content {
    display: block;
    margin: 20px 20px 20px 20px;
    padding: 10px 0px 0px 0px;
  }

  .content {
    min-width: 350px;
    max-width: 1000px;
    text-align: center;
    margin-left: auto;
    margin-right: auto;
  }
  
  .description {
    text-align: left;
    padding: 20px;
  }
  
  .settings {
    padding: 10px;
    text-align: left;
  }
  
  .ui {padding: 10px;}
  
  .label1 {
    display: inline-block;
    width: 40%;
  }

  .textBox1 {
    width: 55%;
    background-color: rgba(80,146,32,0.2);
    border-style: solid;
    border-color: rgba(255,255,255,0.3);
    border-width: 2px;
    color: white;
    transition: background-color 0.6s;
    -webkit-transition: background-color 0.6s;
  }
  
  .dsblTextBox1 {
    background-color: rgba(152,75,67,0.2);
    transition: background-color 0.6s;
    -webkit-transition: background-color 0.6s;
  }
  
  .startBtn {
    width: 75%;
    height: 35px;
    border-style: solid;
    border-width: 1px;
    border-color: rgba(193,136,94,0.85);
    background-color: rgba(80,146,32,0.1);
    color: white;
  }
  
  .startBtn:hover{background: rgba(80,146,32,0.3);}
  
  .startBtn:active{background: rgba(80,146,32,0.2);}
  
  .result {
    width: 75%;
    height: 30px;
    background-color: rgba(80,146,32,0.1);
    text-align: center;
    font-size: 1.2em;
    color: white;
  }
  
  .header {
    width: 100%;
    margin: 0px auto auto auto;
    height: 100px;
    position: relative;
  }

  .insideBorder1 {
    border-style: solid;
    border-width: 1px;
    background-color: rgba(193,136,94,0.05);
    border-color: rgba(193,136,94,0.85);
    box-shadow:0 0 8px rgba(193,136,94,.5);
    -moz-box-shadow:0 0 8px rgba(193,136,94,.5);
    -webkit-box-shadow:0 0 8px rgba(193,136,94,.5);
  }
  
  .logo {
    width: 400px;
    position: relative;
    top: 40px;
  }
  
  .logoBox {
    position: relative;
  }

  .oprBox {
  }
  
  .oprBtn {
    width: 40%;
    height: 35px;
    border-style: solid;
    border-width: 1px;
    border-color: rgba(193,136,94,0.85);
    background-color: rgba(193,136,94,0.1);
    color: white;
  }
  
  .oprBtn:hover{background: rgba(193,136,94,0.3);}
  
  .oprBtn:active{background: rgba(193,136,94,0.2);}
  
  @media screen and (max-width: 1010px) {
    div.content {margin-left: 0;}
    .main {width: 95%;}
    .logo {
      width: 350px;
      top: 40px;
      position: relative;
    }
  }

  @media screen and (max-width: 400px) {
    .main {width: 90%;}
    .logo {
      width: 250px;
      top: 40px;
      position: relative;
    }
  }
  
  ::selection{
    background-color:rgba(193,136,94,0.75);color:#000;
  }
  ::-webkit-selection{
    background-color:rgba(193,136,94,0.75);color:#000;
  }
  ::-moz-selection{
    background-color:rgba(193,136,94,0.75);color:#000;
  }
  </style>
 </head>

 <body>
 
 <div class="content">
 <div class="header">
   <img class="logo" src="./MCPF-logo.png"></img>
 </div>
 <div class="main">
  <div class="main-content">
   <div class="settings insideBorder1">
    <label for="initRange" class="label1">初始范围</label>
    <input type="text" class="textBox1" id="initRange" value="100000">
    <br>
    <label for="initPos"  class="label1">初始中心</label>
    <input type="text" class="textBox1" id="initPos" value="(0,0)">
   </div>
   <br>
    <div class="ui insideBorder1">
    <button id="ctrl" class="startBtn" onclick="startBtnClick()">START</button>
    <br>
    <canvas id="canvas" class="canvas1">
    </canvas>
    <br>
    <input id="result" class="result insideBorder1" readonly>
    <br>
    <span style="display:block;margin-top:5px">目标玩家是否在回传列表中:</span>
    <br>
    <div class="oprBox">
     <button onclick="Y()" id="yes" class="oprBtn">YES</button>
     <button onclick="N()" id="no" class="oprBtn">NO</button>
    </div>
   </div>
   <div class="description">
    <h2>使用方法：</h2>
    <h3>一、准备工作</h3>
    <p><span style="font-weight:bold">本工具仅适用于基岩版。</span>使用前先检查你的服务器是否打开了“允许作弊”选项。若未打开则无法使用本工具，执行指令后会显示<span style="color:#ff5555">选择器扩展权限不足</span>。</p>
    <h3>二、确定初值</h3>
    <p>可以通过r=选择器来估计目标的大致范围。若估计过程中遇到困难，也可直接将范围设为最大值30000000。需注意，输入初值时需严格按照格式输入。</p>
    <h3>三、开始查找</h3>
    <p>点按“开始”按钮即可开始查找。可以通过双击指令显示框快捷复制指令。将指令直接复制至游戏内聊天栏执行，并根据指令回传结果选择“是”或“否”。重复上述操作，直到显示的“坐标误差”降至±500左右，即可停止查找。±500m精度已可用于定位。</p>
   </div>
  </div>
  </div>
  </div>
<script src="./Automac_1010_min.js"></script>
<script src="./canvasDraw.js"></script>
<script>
const RadiusTooSmall     = '当前半径已经足够小了，\n再往下误差就会变大了qwq，\n建议转用游戏内方法进行更精确定位。';
const PlayerNotFound1    = 'Oops! 玩家似乎消失了。\n可能他离开了你所在的维度。\n复位重新查找试试？\n可以把初值设为玩家消失之前的圆心半径减少耗时哦 :D';
const PlayerNotFound2    = 'Oops! 玩家似乎消失了。\n可能他不在你所在的维度。\n复位重新查找试试？';
const PosSyntaxError     = '坐标和范围格式似乎错了qwq';
/* 数据存储变量 */
var step    = 0,
    workObj = wkObj1010,
    elderWObj = workObj,
    active  = false;

var Out = document.getElementById('result');

workObj.cmdHandler = function(x){
  Out.value = genCmd(x.x,x.z,x.dx+x.x,x.dz+x.z);
  if(Math.max(x.dx / 2, x.dx / 2) <= 400)alert(RadiusTooSmall);
};

workObj.errHandler = function(a){
  if(a == 2){
    alert(PlayerNotFound1);
  }
};

document.getElementById("result").onclick = function(e){
  if(!workObj.run)return;
  if(this.active){
    this.select();
    document.execCommand('Copy');
  }else{
    this.active = true;
    let a = this;
    window.setTimeout(function(){
      a.active = false
    }, 200);
  }
};


function changeInitPos(){
  let initPosObj = document.getElementById('initPos');
  let str = initPosObj.value;
  str = str.replace(/\s/g, '').match(/^(\([0-9]+\,[0-9]+\))$/);
  if(str){
    let _pos = str[0].match(/[0-9]+/g);
    return [ Number(_pos[0]), Number(_pos[1]) ];
  } else {
    alert(PosSyntaxError);
    return !1;
  }
}

function changeInitRange(){
  let initRangeObj = document.getElementById('initRange');
  let str = initRangeObj.value;
  if(!isNaN(Number(str))){
    return Number(str);
  } else {
    alert(PosSyntaxError);
    return !1;
  }
}

function startBtnClick(){
  if(!workObj.run){
    init();
  } else {
    if(!active){
      active = true;
      setTimeout(()=>{active = false;}, 200);
    } else {
      reset();
    }
  }
}

function init(){
  let t1 = changeInitRange();
  let t2 = changeInitPos();
  if(t1 && t2){
    document.getElementById('ctrl').innerHTML = '双击复位';
    workObj.init(t2[0],t2[1],t1);
    dsblValueInput();
  }
}

function reset(){
  document.getElementById('ctrl').innerHTML = '开始查找';
  Out.value = "";
  workObj.rst();
  
  enblValueInput();
}

function Y(){
  elderWObj = workObj;
  workObj.Ba();
}

function N(){
  elderWObj = workObj;
  workObj.Bb();
}

function genCmd(xl,zl,xr,zr){
  let a = Math.min(xl,xr),
      b = Math.max(xl,xr),
      c = Math.min(zl,zr),
      d = Math.max(zl,zr);

  if(a==b || c==d)return !1;

  return `/w @s @a[x=${a},y=-64,z=${c},dx=${b-a-1},dy=1024,dz=${d-c-1}]`;
}

function updCmd(){
  Out.value = genCmd(workObj.a,
                     workObj.b,
                     workObj.c,
                     workObj.d);
}

function enblValueInput(){
  document.getElementById("initPos").readOnly = false;
  document.getElementById("initRange").readOnly = false;
   document.getElementById("initPos").classList.remove("dsblTextBox1");
  document.getElementById("initRange").classList.remove("dsblTextBox1");
}

function dsblValueInput(){
  document.getElementById("initPos").readOnly = true;
  document.getElementById("initRange").readOnly = true;
   document.getElementById("initPos").classList.add("dsblTextBox1");
  document.getElementById("initRange").classList.add("dsblTextBox1");
}
</script>
</body>
</html>