<!DOCTYPE html>
<html>
 <head>
  <meta name="viewport" 
   content="width=device-width, 
   initial-scale=1.0,
   maximum-scale=1.0">
  <title>MCPF v0.9</title>
  <meta charset="utf-8">
  <script>
  function getWindowSize(){
    var winWidth, winHeight;

    if(window.innerWidth){
      winWidth = window.innerWidth;
    }else if((document.body) && (document.body.clientWidth)){
      winWidth = document.body.clientWidth;
    }
    
    if(window.innerHeight){
      winHeight = window.innerHeight;
    }else if((document.body) && (document.body.clientHeight)){
      winHeight = document.body.clientHeight;
    }
  
    if(document.documentElement && document.documentElement.clientHeight && document.documentElement.clientWidth){
      winHeight = document.documentElement.clientHeight;
      winWidth = document.documentElement.clientWidth;
    }
  
    return [winWidth, winHeight];
  }
  </script>
  <style>
  input{
    outline: none;
  }
  
  body {
    text-align: center;
    background-color: #A7CAF0;
    background-image: url('./MCPF_bg.png');
    background-size: 256px;
    background-repeat: repeat;
    display: block;
    height: 100%;
    margin: 0;
    padding: 0;
  }

  canvas {
    width: 100%;
  }
  
  .main {
    display: block;
    min-width: 400px;
    max-width: 1000px;
    width: 100%;
    margin: 70px;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
    background-color: rgba(194,238,254,0.5);
    border-radius: 20px;
    font-size: 90%;
  }
  
  .main-content {
    display: block;
    margin: 20px 20px 20px 20px;
    padding: 10px 0px 0px 0px;
  }
  
  .description {
    text-align: left;
    padding: 20px;
  }
  
  .settings {
    padding: 10px;
    text-align: left;
    border-style: solid;
    border-width: 1px;
    border-color: rgb(170,197,222)
  }
  
  .ui {
    padding: 10px;
    border-style: solid;
    border-width: 1px;
    border-color: rgb(170,197,222)
  }
  
  .label1 {
    display: inline-block;
    width: 40%;
  }
  
  .startBtn {
    width: 50%;
    height: 35px;
  }
  
  .result {
    width: 75%;
    height: 30px;
    background-color: rgba(255,255,255,0.1);
    border-style: solid;
    border-width: 1px;
    border-color: rgb(170,197,222);
    text-align: center;
    font-size: 1.2em;
  }
  
  .header {
    width: 400px;
    margin: 0px auto auto auto;
  }
  
  ul.sidenav {
    list-style-type: none;
    margin: 0;
    padding: 0;
    background-color: #f1f1f1;
    position: fixed;
    height: 100%;
    overflow: auto;
    opacity: 0.35;
  }
  
  ul.sidenav:hover {
    opacity: 1.0;
  }

  ul.sidenav li a {
    display: block;
    color: #000;
    padding: 8px 16px;
    text-decoration: none;
  }
 
  ul.sidenav li a.active {
    background-color: #4CAF50;
    color: white;
  }

  ul.sidenav li a:hover:not(.active) {
    background-color: #555;
    color: white;
  }
  
  @media screen and (max-width: 900px) {
    ul.sidenav {
        width: 100%;
        height: auto;
        position: relative;
    }
    ul.sidenav li a {
        float: left;
        padding: 15px;
    }
    div.content {margin-left: 0;}
  }

  @media screen and (max-width: 400px) {
    ul.sidenav li a {
        text-align: center;
        float: none;
    }
  }
  </style>
 </head>

 <body>
 <ul class="sidenav">
  <li><a class="active" href="#about">关于本页</a></li>
  <li><a href="#boxS">缩盒查找</a></li>
  <li><a href="#binS">二分查找</a></li>
  <li><a href="#lineS">寻线查找</a></li>
  <li><a href="#setting">设置</a></li>
 </ul>
 
 <div class="content">
 <div class="header">
  <h1 style="width:100%;margin:0">MCPlayerFinder v0.9</h1>
  <h2 style="width:100%">Made by HTMonkeyG</h2>
 </div>
 <div class="main">
  
  <div class="main-content">
   <div class="settings">
    <label for="initValue" class="label1">Initial Range:</label>
    <input type="text" class="text1" id="initRange" name="initValue" value="100000" onchange="changeInitRange()">
    <br>
    <label for="initPos"  class="label1">Initial center pos:</label>
    <input type="text" class="text1" id="initPos" name="initPos" value="(0,0)" onchange="changeInitPos()">
   </div>
   <br>
    <div class="ui">
    <button id="ctrl" class="startBtn" onclick="StartBtnClick()">START</button>
    <br>
    <canvas id="canvas" width=512 height=64>
    </canvas>
    <br>
    <input id="result" class="result" readonly>
    <br>
    Target player in selection?
    <br>
    <button onclick="Y()" id="yes">YES</button>
    <button onclick="N()" id="no">NO</button>
   </div>
   <div class="description">
    <h3>How to use：</h3>
    Copy the command displays in the text area upside, and paste it to game to execute it.<br>
    If your target player's name is in those names returned by the command, click the "Yes" button.<br>
    If not, click the "No" button.<br><br>
    If there is a customized demand, the value in the input box at the top of the page can be changed.<br>
    A changed value won't be applied in the current process. 
    
    <h3>How it works: </h3>
    This program gets the players in particular area by target selectors.<br>
    
    <h3>Notes: </h3>
    1. This program only avaliable in servers that allows cheat, that is, the "Allow Cheats" in settings must be switched on.<br>
       If it is off, the command will return an error.<br>
    2. The coordinates this program provides is NOT 100% accurate.<br>
   </div>
  </div>
  </div>
  </div>

<script>
/*
  1 状态及其含义列表
  STANDBY  待命
  QUADRANT1 - QUADRANT4  象限查找
  DETAIL1  细分:左半
  DETAIL2  细分:下半
  CONFIRM  确认玩家是否存在
*/
</script>
  
<script>
/* 常量 */
const RadiusTooSmallText = '当前半径貌似已经足够小了。\n再往下误差就会变大了qwq\n可以换用其他查找算法进行精细查找awa';
const PlayerNotFound1    = 'Oops! 玩家似乎消失了。\n可能他离开了你所在的维度。\n复位重新查找试试？\n可以把初值设为玩家消失之前的圆心半径减少耗时哦 :D';
const PlayerNotFound2    = 'Oops! 玩家似乎消失了。\n可能他不在你所在的维度。\n复位重新查找试试？';
const PosSyntaxError     = '坐标输入可能错了qwq';
/* 数据存储变量 */
var step    = 0,
    state   = 'STANDBY',
    range   = 100000,
    initRange = 100000,
    pos     = [ 0, -64, 0 ],
    initPos = [ 0, -64, 0 ],
    delta   = [ 0,   0, 0 ],
    active  = false;
    
/* 功能性变量 */
var Anim = window.requestAnimationFrame ||
           window.webkitRequestAnimationFrame ||
           window.mozRequestAnimationFrame ||
           window.oRequestAnimationFrame ||
           window.msRequestAnimationFrame ||
           function (callback) {
             window.setTimeout(callback, 1000 / 60);
           };
var Out = document.getElementById('result');
var C   = document.getElementById("canvas");
var CTX = C.getContext('2d');

function changeInitPos(){
  let initPosObj = document.getElementById('initPos');
  let str = initPosObj.value;
  str = str.replace(/\s/g, '').match(/\([0-9]+\,[0-9]+\)/);
  if(str){
    let _pos = str[0].match(/[0-9]+/g);
    initPos = [ Number(_pos[0]), -64, Number(_pos[1]) ];
  } else {
    alert(PosSyntaxError);
  }
}

function changeInitRange(){
  let initRangeObj = document.getElementById('initRange');
  let str = initRangeObj.value;
  if(!isNaN(Number(str))){
    initRange = Number(str);
  } else {
    alert(PosSyntaxError);
  }
}

function StartBtnClick(){
  if(state == 'STANDBY'){
    init();
  } else {
    if(!active){
      active = true;
      setTimeout(()=>{active = false;}, 200);
    } else {
      reset();
    }
  }
}

Anim(draw);
function draw(){
  var __SIZE__ = getWindowSize();
    
  //C.width = __SIZE__[0] * 4;
  //C.height = __SIZE__[0] * 4 * 0.2;

  CTX.clearRect(0, 0, C.width, C.height);
  
  Anim(draw);
}

function init(){
  document.getElementById('ctrl').innerHTML = 'Dbl click to reset';
  state = 'X-';
  
  range = initRange;
  delta = [ range, 1000, range ];
  pos   = [ initPos[0] - range / 2, -64, initPos[2] - range / 2 ];
  
  document.getElementById('initPos').readOnly = true;
  document.getElementById('initRange').readOnly = true;
  
  Out.value = CMD('CORNER', [ pos[0], pos[1], pos[2], delta[0], delta[1], delta[2] ]);
}

function reset(){
  document.getElementById('ctrl').innerHTML = 'START';
  state = 'STANDBY';
  
  document.getElementById('initPos').readOnly = false;
  document.getElementById('initRange').readOnly = false;
}

function Y(){
  let dR;

  switch(state){
    case 'X-':
      dR = Math.pow(10, Math.ceil(Math.log(range) / Math.log(10)) - 1);
      if(delta[0] - dR > 0){
        delta[0] -= dR;
      } else {
        state = 'Z-';
      }
      break;
    case 'Z-':
      dR = Math.pow(10, Math.ceil(Math.log(range) / Math.log(10)) - 1);
      if(delta[2] - dR > 0){
        delta[2] -= dR;
      } else {
        state = 'X-';
        range /= 10;
      }
      break;
  }
  
  Out.value = CMD('CORNER', [ pos[0], pos[1], pos[2], delta[0], delta[1], delta[2] ]);
}

function N(){
  switch(state){
    case 'X-':
      dR = Math.pow(10, Math.ceil(Math.log(range) / Math.log(10)) - 1);
      
      pos[0] += delta[0];
      delta[0] = dR;
      state = 'Z-';
      break;
    case 'Z-':
      dR = Math.pow(10, Math.ceil(Math.log(range) / Math.log(10)) - 1);
      
      pos[2] += delta[2];
      delta[2] = dR;
      
      range /= 10;
      
      state = 'X-';
      break;
  }
  
  Out.value = CMD('CORNER', [ pos[0], pos[1], pos[2], delta[0], delta[1], delta[2] ]);
}

function CMD(type, param){
  var r;
  const Cmd = [ '/w @s @a[', ']' ];
  switch(type){
    case 'CENTER':
      r = Cmd[0] + 'x=' + param[0]
                 + ',y=' + param[1]
                 + ',z=' + param[2]
                 + ',r=' + param[3]
                 + Cmd[1];
      break;
    case 'CORNER':
      r = Cmd[0] + 'x=' + param[0]
                 + ',y=' + param[1]
                 + ',z=' + param[2]
                 + ',dx=' + param[3]
                 + ',dy=' + param[4]
                 + ',dz=' + param[5]
                 + Cmd[1];
      break;
  }

  return r;
}
</script>

</body>
</html>